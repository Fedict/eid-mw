---
.robot:windows:
  tags:
  - robot
  - windows
  before_script:
  - cd %WINDOWS_BASEDIR%\scripts\windows
  - build_testsuite.bat
  script:
  - cd %WINDOWS_BASEDIR%\tests\unit\windows\Release
  - pkcs11_tests.exe
  allow_failure: true

.build-windows:
  dependencies: []
  before_script:
  - del /q %WINDOWS_BASEDIR%\scripts\windows\*.exe
  script:
  - cd %WINDOWS_BASEDIR%\scripts\windows
  - build_all.bat
  after_script:
  - rmdir /s /q products
  - mkdir products\windows
  - xcopy %WINDOWS_BASEDIR%\scripts\windows\*.exe products\windows
  - xcopy %WINDOWS_BASEDIR%\scripts\windows\*.msi products\windows
  tags:
  - windows
  artifacts:
    when: on_success
    paths:
    - products\windows
