<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>eid-viewer: About this directory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">eid-viewer
   </div>
   <div id="projectbrief">eid-viewer library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">About this directory</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> The files in this directory are the currently active root certificates for the Belgian eID PKI.</p>
<p>The .0 and .1 files are symlinks to the hashed versions of these certificates, as required by OpenSSL for the <a href="https://www.openssl.org/docs/manmaster/man3/X509_LOOKUP_add_dir.html"><code>X509_LOOKUP_add_dir()</code></a> call.</p>
<p>This directory is used as the trust root by the Linux and macOS eID viewer. The Windows eID viewer uses a different method for validating cards, and does not use these files.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Note on test cards</h1>
<p>The eID viewer does not ship with test card roots. This means that if you insert a test card into a card reader, start the eID viewer, and choose the "validate card" button, that validation will fail.</p>
<p>Given that these are not legal eID cards, this is expected; you don't want anyone to be able to trick you into believing you have a valid eID card when in reality the card is a specimen one. However, that does not mean it is not possible to make the eID viewer validate test cards; it just means you have a bit of configuration to do.</p>
<p>To allow the Linux and macOS viewers to validate test cards as valid, two steps are necessary: first you need to copy the test card's root certificate into this trust directory and rehash the directory; and second, you need to disable the allowlist that limits the OCSP server URLs that may appear on certificates.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Installing the root certificate</h2>
<p>To install the root certificate, first copy it off the card. You can do that using the eID viewer: start the viewer, insert the card, go to the "certificates" tab, right click on the root certificate, and choose the "Export to PEM file..." menu option; then choose a file name in this directory with the ".pem" extension.</p>
<p>Next, you need to rehash the directory, which can be done with the <code>openssl rehash /path/to/dir</code> command. Please note that the version of OpenSSL which is shipped with macOS does not come with a working <code>rehash</code> command; you will have to install a different version of OpenSSL separately (e.g., through homebrew).</p>
<p>On macOS, it is possible to install the root certificate directly into the copy of this directory in the eID Viewer application bundle, which can be found under <code>&lt;eID Viewer&gt;/Contents/Resources/certs</code>. On Linux, the the viewer looks at <code>${pkgdatadir}/trustdir</code> (e.g., <code>/usr/share/eid-mw/trustdir</code>), and installing the root certificate there is equally possible. Alternatively, one can also install the root certificate to this directory in the source, and then rebuild &amp; install the viewer.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Disabling the allowlist</h2>
<p>The viewer will refuse to validate any eID certificate that has an OCSP URL which does not match the ones found on production cards in the field. In order to disable that allowlist, hidden configuration settings need to be modified. Note that when doing so, the eID Viewer will <em>always</em> log a message that this configuration has been modified.</p>
<p>How to do so is operating-system specific:</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Linux</h3>
<ul>
<li>Start the <code>dconf-editor</code> program, installing it first if needed.</li>
<li>Go to the be.belgium.eid.eid-viewer section in dconf-editor</li>
<li>Switch off the <code>check-urls</code> option (i.e., ensure it is set to <code>false</code>, switching off the <code>Use default</code> option if needed).</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
macOS</h3>
<ul>
<li>Close the eID Viewer</li>
<li>Create a file called <code>&lt;eID Viewer&gt;/Contents/Resources/extraopts.plist</code></li>
<li>Make sure it has the following contents: <pre class="fragment">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
  &lt;plist version="1.0"&gt;
  &lt;dict&gt;
          &lt;key&gt;disableAllowlist&lt;/key&gt;
          &lt;true/&gt;
  &lt;/dict&gt;
  &lt;/plist&gt;
</pre></li>
<li>Start the viewer again; the allowlist should be disabled. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
